---
output: pdf_document
---

\begin{quote}
\emph{A promise is a cloud; fulfillment is rain.}
--- Arabian Proverb
\end{quote}

\doublespacing

# Introduction

As presented in the previous chapter, Marginal Mediation Analysis (MMA) has the ability to simplify the interpretation of mediated effects in a wide variety of situations, particularly in situations where an interpretation otherwise does not exist (e.g., indirect effects when the mediator or outcome is categorical). In this chapter, methods fashioned to develop Marginal Mediation Analysis and evaluate its performance are discussed via three phases:

1. Development of MMA
2. Monte Carlo Simulation Study of MMA
3. Application of MMA

\noindent These phases are designed to provide the theory and the software to perform MMA, assess the method's ability to accurately estimate the underlying effects, develop the guidelines of its use in finite samples, and apply it to real-world prevention data about the pathways between chronic illness (i.e., chronic migraines and asthma) and delinquency/substance use. Below, each phase is described in depth.

# Phase 1: Development of Marginal Mediation Analysis

To be useful to public health, psychological, and prevention researchers, the incorporation of average marginal effects within mediation analysis must happen in two ways: in theory and in software. Although the basic framework has been designed, the software and the nuances of the method (e.g., incorporating moderation, assessing the relationship between indirect and total effects, delineating additional model assumptions) need to be developed and assessed.\footnote{It is important to note that when referring to the properties of the estimates we are referring to four distinct, but related, estimates: the $a$ path, the $b$ path, the $a \times b$ (indirect) path, and the $c'$ (direct) path.} Therefore, this phase is focused on understanding the properties of Marginal Mediation and on developing the software necessary to perform it.

## Properties of MMA

Building on the mediation framework discussed by @Hayes2009 and by Edwards and Lambert (2007), Marginal Mediation will be established on linear regression---either ordinary least squares for continuous outcomes/mediators or maximum likelihood for categorical outcomes/mediators. In this framework, two or more regression equations are combined to provide the overall mediation model as discussed in Chapter 2. The proposed method will add a post-estimation step into this mediation framework. 

The form of the general Marginal Mediation model, including the post-estimation step, were discussed in Chapter 4. Using this framework, various considerations will be made in the development of the method. First, an appropriate manner in which to integrate moderation (interaction effects) into the framework is important. Because of the work by Edwards and Lambert (2007), this will likely include assessing the *reduced form*\footnote{Reduced form refers to only having exogenous variables on the right hand side of a regression equation (i.e., substituting the predictors of the mediators into the equation).} of the models. Second, it has been noted by @mackinnon2008intro that in non-linear models the $a \times b + c'$ generally does not equal the $c$ path as it does in linear models (Chapter 11). It is expected that these will equal within the Marginal Mediation framework. Third, an assessment of the various assumptions being made across possible model specifications is required for proper understanding of the method. Its robustness to these assumptions will be assessed in Phase 2 (the Monte Carlo simulation study of the finite properties of Marginal Mediation). Finally, these considerations need to be made for the various mediator/outcome types (multinomial, count, ordinal, dichotomous). 


## Software Development

A major aspect of this first phase is the development of the software for researchers to apply Marginal Mediation. This software will be provided via the R statistical environment given R is free, widely used by researchers in prevention, and extensions to the environment via "packages" are easily disseminated through the Comprehensive R Archive Network (CRAN). The package will be called `MarginalMediation` and will be available for download via CRAN and GitHub. It will consist of a number of functions to fit the model and assess the model’s fit while efficiently producing the paths and effects in proper units. A simple diagram displayed in Figure \ref{fig:mediationsoftware} demonstrates the mechanics of the main function---`marginal_med()`.

\begin{figure}[tb]
  \includegraphics[width=\linewidth]{Fig_marginal_mediation.jpg}
  \caption{Diagram of the primary functions of the Marginal Mediation software in R.}
  \label{fig:mediationsoftware}
\end{figure}

The package will apply the best practices for both computational speed and user readability [@Wickham2015], allowing other researchers to extend the package more easily. Several built-in tests will inform the functionality of the package before beginning Phase 2. These tests will be performed on Linux, Mac, and Windows platforms. Finally, the package will use Git as the version control software.

## Potential Problems and Solutions

The main issue that may come up within this phase is that the software may take longer than expected to develop. The necessary functions will be developed first so that the next phase may continue on schedule. The usability that will be important in the disseminated version will be developed last.

# Phase 2: Monte Carlo Simulation Study of Marginal Mediation Analysis

The evaluation of the new method is an essential step in understanding its properties and robustness and further assess the performance of the software. It is expected that Marginal Mediation will be consistent (as are average marginal effects; see Chapter 3) in estimating the underlying probabilities within each path, thus providing accurate measures for both the indirect and direct effects. This expectation will be evaluated via a Monte Carlo simulation study [@Paxton2001]. 

In the study, data will be simulated to come from a population of known parameters. A thorough literature review of mediation analysis in prevention work will inform on several of the facets of the study, including appropriateness of the selected sizes of the various mediated paths, the sample sizes, and the common combinations of categorical mediators and/or outcomes in these studies. Further, the insights provided in Phase I will inform on any adjustments that must be made regarding the simulation study (e.g., relax other assumptions that are not currently included in the simulation design). The results of the simulation study will help in the development of the guidelines for using Marginal Mediation in practice.

## Literature Review

Before performing the Monte Carlo simulations a thorough review of the literature is necessary [@Paxton2001]. This review will focus on the use of mediation analysis in prevention research where the data has categorical mediators and/or outcomes.\footnote{Those studies found in the literature search will also be considered for replication via Marginal Mediation in later studies not part of this proposal.}

## Simulation Studies

A Monte Carlo simulation study, via the R statistical environment version 3.4.1, will assess the finite properties of the proposed method. Monte Carlo simulation was selected due to its simplicity in generating informative results and its high success in the literature [e.g., @Graham2007; @Nylund2007]. Here, 500 data sets will be simulated for each condition [@Paxton2001]. The data will be simulated from a known population with a researcher specified causal model (i.e., the "population model"). The model will consist of a binary mediator (0 = "No", 1 = "Yes"), a continuous outcome, a continuous predictor and a dichotomous predictor (dummy coded). 

The $a$ path population model is defined below, where the $Prob(M = 1)$ is a latent continuous variable with a linear or logistic relationship with the predictors (only linear is shown; see Table \ref{tab_conditions}) and the $\epsilon_i$ is normally distributed with a mean of 0 and a standard deviation of 1.
\begin{equation}
Prob(M = 1)_{i} = a_0 + a_1 x_{cont} + a_2 x_{dummy} + \epsilon_i
\end{equation}
\noindent The observed variable, $M_{i}$, is defined as follows:
\begin{equation}
M_{i} = \begin{cases}
            0, & \text{if } Prob(M = 1) < .5, \\
            1, & \text{otherwise}.
         \end{cases}
\end{equation}
\noindent The $b$ and $c'$ paths population model is identical to Equation \ref{equation_b} with only two predictors and a single binary mediator. 

```{r, message=FALSE, results='hide'}
options(xtable.comment = FALSE)
tab = read.csv("~/Dropbox/1 Dissertation/Manuscript/Data/ConditionsTable.csv")
names(tab) = c("Independent Variables", "Conditions")
library(xtable)
tabx = xtable(tab[, 1:2], 
       label = "tab_conditions", 
       caption = "The various experimental conditions of the Monte Carlo simulation study.",
       align = c("l", "|l", "|c|"))
print.xtable(tabx, include.rownames = FALSE, caption.placement = "top",
             table.placement = "tb")
```

\begin{table}[tb]
\centering
\caption{The various experimental conditions of the Monte Carlo simulation study.} 
\label{tab_conditions}
\begin{tabular}{lc}
  \hline
Independent Variables & Conditions \\ 
  \hline
Sample Size  & 200, 500  \\ 
  Effect size of a path - (probability units) & .05, .10, .20, .50 \\ 
  Effect size of b path - standardized  & .10, .30, .50  \\ 
  Effect size of c' path - standardized  & 0, .30  \\ 
  Proportion of Positive Response (Binary Mediators) & .05, .10, .50 \\ 
  Number of Mediators in Model  & 1, 3 \\ 
  Relationship of Probability & Logistic, Linear \\ 
  Bootstrap Size & 500, 1000 \\ 
   \hline
   \hline
  Total Conditions  & 1,152 \\ 
   \hline
\end{tabular}
\end{table}

Table \ref{tab_conditions} highlights the conditions that will be varied for each simulation. A distinct Marginal Mediation model will be applied to each of the 500 data sets for each possible combination of experimental conditions. This means 576,000 total models will be fit. 

The focus of the simulation study will be to gauge the accuracy of the average marginal effects at estimating the population effects while undergoing the experimental conditions. The dependent variables will be: bias (i.e., is the mean of the estimates at the population mean?), power (i.e., how often does the null properly get rejected?), confidence interval coverage (i.e., does the confidence interval cover the proper interval?), and how closely $a \times b + c'$ is to $c$ (i.e., does the indirect plus the direct effect equal the total effect?). The effects of the conditions on these outcomes will be assessed via visualizations, descriptive tables, and regression---testing the main effects of each variable. 

## Guideline Development

Recommendations from the simulation study will be documented, including necessary sample sizes, bias in various conditions, and the needed number of bootstrapped samples for proper confidence intervals. The documentation will be available in manual form online on the [R website](http://www.r-project.org), [GitHub](github.com), and [arXiv.org](arXiv.org).

## Potential Problems and Solutions

Two potential problems are notable. First, the vast amount of computation and data inherent in Monte Carlo studies may overwhelm the laboratory computer. If this is the case, the “super-computer” cluster available to the Prevention Science Laboratory will be used. Second, if the effect sizes, the dimensions of the data, and other nuances common in prevention data found in the literature review are vastly different than that proposed, the proposed conditions will be adjusted accordingly.



# Phase 3: Application of Marginal Mediation Analysis

During the third phase, all important aspects of Marginal Mediation discovered throughout the first two phases will be used to assess the mediated effects of the relationship between chronic illnesses and delinquency/substance use among adolescents. The application will also demonstrate the ability to include latent class analysis into the framework.

## Application

An application study that both explicitly demonstrates the new method and highlights new substantive work will be undertaken. The research questions inherent in this study are informed by a major meta analysis [@Pinquart2011] and an original study [@Suris2008]. In these studies, it is clear that chronic illness---including migraines and asthma---is associated with delinquency, depression, anxiety, and substance use. These studies did not explicitly assess a mediated effect, although depression and anxiety are likely mediators of the relationship between chronic illness and delinquency/substance use [@Deykin1986; @Manasse2009].

To assess these relations, data from the National Longitudinal Study of Adolescent Health [“Add Health”; @Harris2013] will be used. These data include longitudinal information on adolescents (n = 14,960, at wave I), including their delinquent and substance use patterns. The measures of interest consisted of: wave I parent report of the chronic conditions ("For each of the following health conditions, please tell me whether [your child] has [asthma, migraines].") and wave II self-report of delinquency (consisting of 15 items) and substance use ("During the past 30 days, how many times have you used marijuana?" and "During the past two weeks, how many times did you have 5+ drinks on a single occasion?"). The mediators will be depression [19 items taken from the CES-D Scale; @Radloff1977] and anxiety (a collection of 7 items relating to general symptoms of anxiety) from wave I. Additional variables (both covariates and mediators), as informed by the literature review, can be included as well. 

Ultimately, the study will assess the path between migraines/asthma (and their interaction) with delinquency and substance use. Figure \ref{fig:theorymed} highlights the theoretical model (not explicitly showing the interaction of migraines and asthma), where both outcomes (i.e., delinquency and substance use) are categorical; delinquency will be categorical---based on a latent class analysis---and substance use is an observed four level multinomial variable (smokes marijuana, drinks heavily, both marijuana and heavy drinking, or neither behavior). 
\begin{figure}[tb]
  \includegraphics[width=\linewidth]{Fig_TheoryMed.jpg}
  \caption{Path diagram of the two theoretical models: a) with delinquency and b) with substance use. Both outcomes are categorical, with delinquency being a latent categorical variable and substance use being observed categorical.}
  \label{fig:theorymed}
\end{figure}

Notably, the latent class analysis will be based on a manuscript in preparation showing several latent classes of delinquency, including a violent class, a theft-oriented class, and an all-around delinquent class. Although this was based on wave I data, similar findings are expected in wave II. Using this latent class analysis, latent class regression will be performed for all $b$ and $c'$ classes. The post-estimation average marginal effects will be calculated for each path. The interpretation of the effects will then inform on the difference in the risk of being in a certain delinquent class (or having used marijuana or alcohol) for adolescents that have migraines (or asthma or both) through either the indirect or the direct effect. 
 
## Potential Problems and Solutions 

Some problems regarding the application study are of concern. First, although unlikely, depression and anxiety may not be important mediators (as informed by the literature review). If so, other variables may be included (e.g., family and peer relationships, other health-risk behaviors, or school performance). Additionally, the measures used in the application are self- or parent-report. There is likely measurement error, but as it is in many large surveys, there is no reliable way to remove it and will, therefore, be a limitation. Finally, the application study may bring nuances of the method to light (e.g., problems with the software). These can help inform the guidelines and can provide opportunities for further development.

# Strengths and Weaknesses

The Marginal Mediation approach allows meaningful interpretation regarding mediated effects. It is expected that improving interpretation and increasing the fit of the modeling procedures with more data situations will increase both the results and inference reproducibility discussed in Chapter 1. Several facets of the project enhance the strength and increase the likelihood of success. First, the initial integration and preliminary construction of the software have taken place, providing valuable information on the planning of the method. Second, by developing the software in R, researchers around the world can apply it at no cost. Third, by assessing the finite properties via Monte Carlo simulations, there will be guidelines for its use immediately available upon dissemination. Fourth, by applying Marginal Mediation to prevention data, the walk-through of Marginal Mediation will be provided and real-world mediated effects will be explored. 

However, the Marginal Mediation approach has two notable limitations. First, mediation analysis assumes no measurement error in the mediators. Although latent variable methods can help with this [@Lockhart2011; @Iacobucci2008book], the data necessary are not always available. Therefore, the estimates are only as good as the data used. Second, it may also be difficult for researchers to accept given the newness of average marginal effects in the field. This will be alleviated through the use of various introductions to average marginal effects and its use in other fields.

# Conclusions

The goal of this proposal is to develop, evaluate and apply a method that can provide meaningful interpretation in mediation when the mediator and/or outcome is categorical---ultimately increasing the reproducibility and application of research results. Each phase builds on this goal, providing a final product that is both in theory, software, and application useful for prevention scientists for a wide variety of research situations. 






\singlespacing